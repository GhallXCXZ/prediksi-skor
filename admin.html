<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100">

<div class="max-w-6xl mx-auto mt-10 bg-white p-6 rounded shadow">
  <h1 class="text-xl font-bold mb-3">Admin Panel</h1>

  <input id="pertandingan" placeholder="Nama match" class="p-2 border rounded">
  <button onclick="add()" class="bg-green-600 text-white px-3 py-2 rounded ml-2">Tambah</button>

  <ul id="matches" class="my-4"></ul>

  <h2 class="font-semibold">Prediksi</h2>
  <table class="w-full border mt-2">
    <thead>
      <tr><th>Nama</th><th>Match</th><th>Skor</th></tr>
    </thead>
    <tbody id="predictions"></tbody>
  </table>

  <h2 class="font-semibold mt-4">Leaderboard</h2>
  <ol id="leaderboard"></ol>
</div>

<script>
const API = 'https://prediksi-skor.onrender.com';

async function add() {
  const r = await fetch(API + '/admin/match', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ pertandingan: pertandingan.value })
  });
  alert((await r.json()).message);
  pertandingan.value='';
  load();
}

async function closeMatch(id) {
  await fetch(API + '/admin/match/' + id + '/close', { method:'POST' });
  load();
}

async function load() {
  const m = await (await fetch(API + '/matches')).json();
  matches.innerHTML='';
  m.forEach(x=>{
    matches.innerHTML+=`
      <li>
        ${x.pertandingan} (${x.status})
        ${x.status==='OPEN'?`<button onclick="closeMatch(${x.id})">[Tutup]</button>`:''}
      </li>`;
  });

  const p = await (await fetch(API + '/admin/predictions')).json();
  predictions.innerHTML='';
  p.forEach(x=>{
    predictions.innerHTML+=`<tr><td>${x.name}</td><td>${x.pertandingan}</td><td>${x.home_score}-${x.away_score}</td></tr>`;
  });

  const l = await (await fetch(API + '/leaderboard')).json();
  leaderboard.innerHTML='';
  l.forEach(x=> leaderboard.innerHTML+=`<li>${x.name} (${x.total})</li>`);
}

setInterval(load,3000);
load();
</script>
</body>
</html>
