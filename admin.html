<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100">

<div class="max-w-6xl mx-auto mt-10 bg-white dark:bg-gray-800 p-6 rounded shadow">
  <h1 class="text-2xl font-bold mb-4">âš™ï¸ Admin Panel</h1>

  <!-- Tambah Match -->
  <div class="mb-6">
    <input id="pertandingan" placeholder="Inter vs Man City"
      class="p-2 border rounded w-2/3">
    <button onclick="buatMatch()"
      class="bg-green-600 text-white px-4 py-2 rounded ml-2">
      Tambah Match
    </button>
  </div>

  <!-- List Match -->
  <h2 class="font-semibold mb-2">ğŸ¯ Daftar Match</h2>
  <ul id="matchList" class="mb-6"></ul>

  <!-- Prediksi -->
  <h2 class="font-semibold mb-2">ğŸ‘€ Semua Prediksi</h2>
  <table class="w-full border mb-6">
    <thead class="bg-gray-200">
      <tr>
        <th class="border p-2">Nama</th>
        <th class="border p-2">Match</th>
        <th class="border p-2">Skor</th>
      </tr>
    </thead>
    <tbody id="predictions"></tbody>
  </table>

  <!-- Leaderboard -->
  <h2 class="font-semibold mb-2">ğŸ† Leaderboard</h2>
  <ol id="leaderboard" class="list-decimal ml-6"></ol>
</div>

<script>
const API = 'https://prediksi-skor.onrender.com';

// Tambah Match
async function buatMatch() {
  const pertandingan = document.getElementById('pertandingan').value;
  if (!pertandingan) return alert('Isi nama pertandingan');

  const res = await fetch(API + '/admin/match', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ pertandingan })
  });

  const data = await res.json();
  alert(data.message);
  document.getElementById('pertandingan').value = '';
  loadAll();
}

// Load Match List
async function loadMatches() {
  const res = await fetch(API + '/matches');
  const data = await res.json();
  const ul = document.getElementById('matchList');
  ul.innerHTML = '';

  data.forEach(m => {
    ul.innerHTML += `
      <li class="mb-1">
        ${m.pertandingan} 
        <span class="text-sm text-gray-500">(${m.status})</span>
        ${m.status === 'OPEN'
          ? `<button onclick="closeMatch(${m.id})" class="text-red-600 ml-2">[Tutup]</button>`
          : ''}
      </li>
    `;
  });
}

// Close Match
async function closeMatch(id) {
  const res = await fetch(API + '/admin/match/' + id + '/close', {
    method: 'POST'
  });
  const data = await res.json();
  alert(data.message);
  loadAll();
}

// Load Prediksi
async function loadPredictions() {
  const res = await fetch(API + '/admin/predictions');
  const data = await res.json();
  const tbody = document.getElementById('predictions');
  tbody.innerHTML = '';

  data.forEach(p => {
    tbody.innerHTML += `
      <tr>
        <td class="border p-2">${p.name}</td>
        <td class="border p-2">${p.pertandingan}</td>
        <td class="border p-2">${p.home_score} - ${p.away_score}</td>
      </tr>
    `;
  });
}

// Leaderboard
async function loadLeaderboard() {
  const res = await fetch(API + '/leaderboard');
  const data = await res.json();
  const ol = document.getElementById('leaderboard');
  ol.innerHTML = '';
  data.forEach((l, i) => {
    ol.innerHTML += `<li>${l.name} (${l.total} prediksi)</li>`;
  });
}

function loadAll() {
  loadMatches();
  loadPredictions();
  loadLeaderboard();
}

setInterval(loadAll, 3000);
loadAll();
</script>

</body>
</html>
